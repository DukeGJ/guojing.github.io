---
title: HashMap源码分析
date: 2019-10-29 11:22:18
tags:
---
# 背景
HashMap在jdk1.8中，HashMap是由数组，链表，树实现的
# 常用知识
在开始分析源码之前，我们先来复习几个概念：
## 哈希算法
将任意长度的二进制值串映射为固定长度的二进制值串，这个映射的规则就是哈希算法，而通过原始数据映射之后得到的二进制值串就是哈希值（散列值）．一个优秀的哈希算法需要满足：
- 从哈希值不能反向推导出原始数据（所以哈希算法也叫单向哈希算法）；
- 对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也大不相同；
- 散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小；
- 哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值。
- 装填因子=(哈希表中的记录数)/(哈希表的长度),装填因子是哈希表装满程度的标记因子。值越大，填入表中的数据元素越多，产生冲突的可能性越大。

## 红黑树
在学习红黑树之前，先学习二叉查找树（BST），先来看一下二叉查找树的特点
- 左子树上所有的节点的值均小于等于它的根节点的值
- 右子树上所有的节点的值均大于等于它的根节点的值
- 左右子树也一定分别为二叉排序树

在某些情况下，比如根节点足够大，就会造成左子树或者右子树特别长，查找性能大打折扣，几乎等同于线性查找
所以就需要特定的操作保持二叉树的平衡，红黑树就是一种特殊的平衡二叉树，有如下特点：
- 节点是红色或者黑色
- 根节点是黑色
- 每个红色节点的两个子节点都是黑色（从每个叶子节点到跟的路径上不能有两个连续的红色节点）
- 从任一节点到其每个叶子的节点的路径都包含相同数目的黑色节点

# 源码分析
先看一下HashMap中的常量含义
```
//默认容量为16
static final int DEFAULT_INITIAL_CAPACITY = 1 << 4;
//最大容量为2^30
static final int MAXIMUM_CAPACITY = 1 << 30;
//默认装在因子为0.75
static final float DEFAULT_LOAD_FACTOR = 0.75f;
//链表转为红黑树的阈值
static final int TREEIFY_THRESHOLD = 8;
//红黑树转为链表的阈值
static final int UNTREEIFY_THRESHOLD = 6;
//数组转为红黑树的阈值
static final int MIN_TREEIFY_CAPACITY = 64;
```